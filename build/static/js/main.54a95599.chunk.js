(this.webpackJsonpreact_chut2=this.webpackJsonpreact_chut2||[]).push([[0],{22:function(t,e,n){},24:function(t,e,n){},30:function(t,e,n){"use strict";n.r(e);var c=n(3),r=n.n(c),a=n(15),s=n.n(a),o=(n(22),n(12)),i=n(8),u=n.n(i),l=n(11),d=(n(24),n(2));var p=function(t){var e=function(t){var e=r.a.useState(t),n=Object(o.a)(e,2),c=n[0],a=n[1];function s(){a(new Date)}return r.a.useEffect((function(){var t=setInterval((function(){return s()}),1e3);return function(){clearInterval(t)}})),c}(new Date);return Object(d.jsx)("div",{children:Object(d.jsx)("h1",{className:"time",children:e.toLocaleTimeString()})})},j=n(9),b=(n(31),n(27),{apiKey:"AIzaSyA5ZNxod7Id7oQLNAPC8aDO7maOoNcR69U",authDomain:"chut2-c2958.firebaseapp.com",databaseURL:"https://chut2-c2958-default-rtdb.firebaseio.com",projectId:"chut2-c2958",storageBucket:"chut2-c2958.appspot.com",messagingSenderId:"861344867001",appId:"1:861344867001:web:01cf3be224a6a9ac743168"}),h=n(17);n(29);j.a.initializeApp(b);var f=j.a.auth(),x=j.a.firestore(),m=[];function O(){var t=function(){var t=Object(l.a)(u.a.mark((function t(){var e;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new j.a.auth.GoogleAuthProvider,t.next=3,f.signInWithPopup(e);case 3:x.collection("accounts").doc(f.currentUser.uid).get().then((function(t){if(t.exists){console.log("account exists");j.a.firestore().collection("accounts").doc(f.currentUser.uid)}else{console.log("creating account...");var e={useruid:f.currentUser.uid,name:f.currentUser.displayName,email:f.currentUser.email,busStops:[]};j.a.firestore().collection("accounts").doc(f.currentUser.uid).set(e)}}));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(d.jsx)("button",{className:"sign-in",onClick:t,children:"Sign in with Google"})}function v(){var t=Object(c.useState)(""),e=Object(o.a)(t,2),n=e[0],r=e[1];function a(){return(a=Object(l.a)(u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.next=3,fetch("https://svc.metrotransit.org/NexTrip/".concat(n,"?format=json"));case 3:t.sent.ok?(m.push(n),x.collection("accounts").doc(f.currentUser.uid).get().then((function(t){t.exists&&j.a.firestore().collection("accounts").doc(f.currentUser.uid).update({busStops:j.a.firestore.FieldValue.arrayUnion(n)})})),e.target.reset()):alert("".concat(n," is not a valid Metro Bus Stop ID."));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(d.jsxs)("form",{onSubmit:function(t){return a.apply(this,arguments)},children:[Object(d.jsx)("label",{className:"mr-sm-2",htmlFor:"busIDInput",children:"Add Metro Bus Stop ID"}),Object(d.jsx)("input",{type:"number",onChange:function(t){return r(t.target.value)},placeholder:"16086",maxLength:"5",max:"99999",min:"1",id:"busIDInput",required:!0}),Object(d.jsx)("button",{className:"add",type:"submit",disabled:!n,children:"Add"})]})}function g(t){return Object(d.jsx)("div",{children:t.allStops.map((function(e,n){return Object(d.jsxs)("div",{children:[Object(d.jsxs)("h2",{children:[Object(d.jsx)("a",{href:"https://www.metrotransit.org/nextrip/".concat(t.busStops[n]),target:"_blank",children:t.busStops[n]}),Object(d.jsx)("button",{className:"delete",type:"button",onClick:function(e){return c=t.busStops[n],m=m.filter((function(t){return t!==c})),void x.collection("accounts").doc(f.currentUser.uid).get().then((function(t){t.exists&&j.a.firestore().collection("accounts").doc(f.currentUser.uid).update({busStops:j.a.firestore.FieldValue.arrayRemove(c.toString())})}));var c},children:"X"})]}),Object(d.jsxs)("table",{children:[Object(d.jsx)("thead",{children:Object(d.jsxs)("tr",{children:[Object(d.jsx)("th",{children:"Bus No."}),Object(d.jsx)("th",{children:"Time"})]})}),Object(d.jsx)("tbody",{children:e&&!e.length?Object(d.jsxs)("tr",{children:[Object(d.jsx)("td",{children:" - "}),Object(d.jsx)("td",{children:" - "})]}):e?e.slice(0,5).map((function(t,e){return Object(d.jsxs)("tr",{children:[Object(d.jsx)("td",{className:"td ".concat(t.Actual?"active":""),children:t.Route}),Object(d.jsx)("td",{className:"td ".concat(t.Actual?"active":""),children:t.DepartureText})]},"".concat(t.Route,"_").concat(t.DepartureTime,"_").concat(t.RouteDirection))})):void 0})]})]},"".concat(t.busStops[n],"_").concat(n))}))})}var S=function(){var t,e=Object(h.a)(f),n=Object(o.a)(e,1)[0],r=[[{Actual:!1,DepartureText:"Loading..."}]],a=Object(c.useState)([r]),s=Object(o.a)(a,2),i=s[0],j=s[1],b=function(){var t=Object(l.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(e.map((function(t){return S(t)})));case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),S=function(){var t=Object(l.a)(u.a.mark((function t(e){var n,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://svc.metrotransit.org/NexTrip/".concat(e,"?format=json"));case 2:if(!(n=t.sent).ok){t.next=8;break}return t.next=6,n.json();case 6:return c=t.sent,t.abrupt("return",c);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),w=function(){var t=Object(l.a)(u.a.mark((function t(){var e,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b(m);case 2:if(e=t.sent,j(e),!n||!f.currentUser.uid){t.next=9;break}return t.next=7,x.collection("accounts").doc(f.currentUser.uid).get();case 7:c=t.sent,m!==c.data().busStops&&m.length<=c.data().busStops.length&&(m=c.data().busStops);case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();function y(){return m=[],f.currentUser&&Object(d.jsx)("button",{type:"button",className:"delete",onClick:function(){f.signOut().then(j(r))},children:Object(d.jsx)("span",{className:"glyphicon glyphicon-log-out"})})}return Object(c.useEffect)((function(){if(n){var t=setInterval(Object(l.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:w();case 1:case"end":return t.stop()}}),t)}))),1e3);return function(){clearInterval(t)}}}),[i,m,n]),Object(d.jsxs)("div",{className:"App",children:[Object(d.jsx)("header",{className:"App-header",children:Object(d.jsx)(p,{})}),n?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsxs)("div",{children:[Object(d.jsxs)("h2",{children:["Hello ",f.currentUser.displayName," ",Object(d.jsx)(y,{})]}),Object(d.jsxs)("p",{className:"signed-in-with",children:["Signed in with ",f.currentUser.email]})]}),Object(d.jsx)(v,{}),Object(d.jsx)(g,{allStops:i,busStops:m},(t="","".concat(t,"_").concat((new Date).getTime())))]}):Object(d.jsx)(O,{})]})},w=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,32)).then((function(e){var n=e.getCLS,c=e.getFID,r=e.getFCP,a=e.getLCP,s=e.getTTFB;n(t),c(t),r(t),a(t),s(t)}))};s.a.render(Object(d.jsx)(r.a.StrictMode,{children:Object(d.jsx)(S,{})}),document.getElementById("root")),w()}},[[30,1,2]]]);
//# sourceMappingURL=main.54a95599.chunk.js.map